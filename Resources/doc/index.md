BeelabTagBundle Documentation
=============================

## Installation

1. [Installation](#1-installation)
2. [Configuration](#2-configuration)
3. [Usage](#3-usage)

### 1. Installation

Run from terminal:

```bash
$ php composer.phar require beelab/tag-bundle:1.0.*
```

Enable bundle in the kernel:

```php
<?php
// app/AppKernel.php

public function registerBundles()
{
    $bundles = array(
        // ...
        new Beelab\TagBundle\BeelabTagBundle(),
    );
}
```

### 2. Configuration

Create a ``Tag`` entity class.
Example:

```php
<?php
// src/Acme/DemoBundle/Entity

namespace Acme\DemoBundle\Entity;

use Beelab\TagBundle\Tag\TagInterface
use Doctrine\ORM\Mapping as ORM;

/**
 * Tag
 *
 * @ORM\Table(name="tag")
 * @ORM\Entity()
 */
class Tag implements TagInterface
{
    // ...
    protected $name;

    public function setName($name)
    {
        $this->name = $name;
    }

    // ... implement all methods required by interface
}
```

Insert in main configuration:

```yaml
# app/config/config.yml

# BeelabTag Configuration
beelab_tag:
    tag_class: Acme\DemoBundle\Entity\Tag
    purge: true
```

> **Warning**: the ``purge`` option is not mandatory and defaults to ``false``. You should use this
> option (with ``true`` value) only if you want to delete a tag when a taggable entity
> is deleted. You should avoid purging tags if you configured more than a taggable entity,
> since this could lead to constraint violations.

Then you can create some entities that implement ``TaggableInteface``.

Suppose you want to use tags on an ``Article`` entity:

```php
<?php
// src/Acme/DemoBundle/Entity

namespace Acme\DemoBundle\Entity;

use Beelab\TagBundle\Tag\TagInterface
use Beelab\TagBundle\Tag\TaggableInterface
use Doctrine\ORM\Mapping as ORM;

/**
 * Article
 *
 * @ORM\Table(name="article")
 * @ORM\Entity()
 */
class Article implements TaggableInterface
{
    /**
     * @ORM\ManyToMany(targetEntity="Tag", inversedBy="articles")
     * @ORM\JoinTable()
     */
    protected $tags;

    // note that you must change code generated by Doctrine,
    // replacing "Tag" with "TagInterface" where appropriate

    /**
     * Add tag
     *
     * @param  TagInterface $tag
     * @return Article
     */
    public function addTag(TagInterface $tag)
    {
        $this->tags[] = $tag;

        return $this;
    }

    // ... implement all methods required by interface
}
```

### 3. Usage

Most simple usage is in a Form like this one:

```php
<?php
// src/Acme/DemoBundle/Form/Type/ArticleFormType

namespace Acme\DemoBundle\Form\Type;

use Symfony\Component\Form\AbstractType;
use Symfony\Component\Form\FormBuilderInterface;
// ...

class ArticleFormType extends AbstractType
{
    public function buildForm(FormBuilderInterface $builder, array $options)
    {
        $builder
            ->add('tagsText', 'text', array('required' => false, 'label' => 'Tags'))
            // other fields...
        ;
    }
}
```

Then, add a ``$tagsText`` property to your entity:

```php
<?php
// src/Acme/DemoBundle/Entity

class Article implements TaggableInterface
{
    // ...

    protected $tagsText;

    // ...

    /**
     * Set tags text
     *
     * @param  string
     * @return Article
     */
    public function setTagsText($tagsText)
    {
        $this->tagsText = $tagsText;
        // this is a possible use with Gedmo Timestampable
        $this->setUpdated(new \DateTime());

        return $this;
    }

    /**
     * Get tags text
     *
     * @return string
     */
    public function getTagsText()
    {
        $this->tagsText = implode(', ', $this->tags->toArray());

        return $this->tagsText;
    }

    /**
     * {@inheritDoc}
     */
    public function getTagNames()
    {
        return empty($this->tagsText) ? array() : array_map('trim', explode(',', $this->tagsText));
    }

    // ...
}
```

Note that you need to change something in your Entity when ``$tagsText`` is updated,
otherwise flush is not triggered and tags won't work. In example above, we're using
[Gedmo Timestampable extension](https://github.com/stof/StofDoctrineExtensionsBundle).
